<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profilo Utente</title>
    <link rel="stylesheet" href="/css/navbar-sidebar.css" />
    <link rel="stylesheet" href="/css/profile-utente.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    />
  </head>

  <body>
    <!-- ===== APP CONTAINER ===== -->
    <div id="app">
      <!-- ===== NAVBAR (COMPONENTE IMPORTATO) ===== -->
      <%- include('./components/navbar') %>

      <!-- ===== SIDEBAR (COMPONENTE IMPORTATO) ===== -->
      <%- include('./components/sidebar') %>

      <!-- ===== MAIN CONTENT AREA ===== -->
      <main class="main-content">
        <div class="container">
          <!-- ===== PROFILO UTENTE SECTION ===== -->
          <section id="profile" class="page-section active">
            <!-- ===== CARD: INFORMAZIONI PERSONALI ===== -->
            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-user-circle"></i>
                  Informazioni Personali
                </h2>
                <!-- Mostra bottone modifica SOLO se NON admin -->
                <% if (user.role !== 'admin') { %>
                <button class="btn-modify" id="modifyProfileBtn">
                  <i class="fas fa-edit"></i>
                  <span>Modifica</span>
                </button>
                <% } %>
              </div>
              <div class="card-body">
                <div class="info-grid">
                  <!-- Nome e Cognome (2 colonne) -->
                  <div class="info-row">
                    <div class="info-field">
                      <label class="info-label">Nome</label>
                      <div class="info-value" id="userNome">Matteo</div>
                    </div>
                    <!-- Mostra cognome SOLO se NON admin -->
                    <div class="info-field">
                      <label class="info-label">Cognome</label>
                      <div class="info-value" id="userCognome">Rossi</div>
                    </div>
                  </div>

                  <!-- Email (full width) -->
                  <div class="info-row">
                    <div class="info-field full-width">
                      <label class="info-label">Email</label>
                      <div class="info-value" id="userEmail">
                        matteo@example.com
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===== CARD: SICUREZZA ===== SOLO SE NON ADMIN ===== -->
            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-lock"></i>
                  Sicurezza
                </h2>
              </div>
              <div class="card-body">
                <div class="security-section">
                  <!-- Elemento di sicurezza: Password -->
                  <div class="security-item">
                    <div class="security-info">
                      <h3 class="security-title">Password</h3>
                      <p class="security-description">
                        Modifica la tua password periodicamente per mantenere
                        l'account sicuro
                      </p>
                    </div>
                    <button class="btn-security" id="modifyPasswordBtn">
                      <i class="fas fa-key"></i>
                      Modifica Password
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===== CARD: INFORMAZIONI ACCOUNT ===== -->
            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-user-circle"></i>
                  Informazioni Account
                </h2>
              </div>
              <div class="card-body">
                <div class="info-row">
                  <!-- Data Registrazione -->
                  <div class="info-field">
                    <label class="info-label">Data Registrazione</label>
                    <div class="info-value" id="userDataReg">09/12/2025</div>
                  </div>
                  <!-- Stato Account con Badge -->
                  <div class="info-field">
                    <label class="info-label">Stato Account</label>
                    <div class="info-value info-value-badge">
                      <span class="status-badge status-attivo" id="userStatus"
                        >Attivo</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===== SEZIONI SOLO UTENTI (NON ADMIN) ===== -->
            <% if (user.role !== 'admin') { %>
            <!-- ===== CARD: STATISTICHE ACCOUNT ===== -->
            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-chart-line"></i>
                  Statistiche Account
                </h2>
              </div>
              <div class="card-body">
                <div class="stats-grid">
                  <!-- Prima riga: Corse Totali, Spesa Totale, Km Totali -->
                  <div class="stats-row">
                    <div class="stat-card">
                      <div class="stat-icon">
                        <i class="fas fa-route"></i>
                      </div>
                      <div class="stat-content">
                        <div class="stat-label">Corse Totali</div>
                        <div class="stat-value" id="userTotalRides">0</div>
                      </div>
                    </div>

                    <div class="stat-card">
                      <div class="stat-icon">
                        <i class="fas fa-money-bill-wave"></i>
                      </div>
                      <div class="stat-content">
                        <div class="stat-label">Spesa Totale</div>
                        <div class="stat-value" id="userTotalSpent">€ 0,00</div>
                      </div>
                    </div>

                    <div class="stat-card">
                      <div class="stat-icon">
                        <i class="fas fa-road"></i>
                      </div>
                      <div class="stat-content">
                        <div class="stat-label">Km Totali</div>
                        <div class="stat-value" id="userTotalKm">0 km</div>
                      </div>
                    </div>
                  </div>

                  <!-- Seconda riga: Ultimo Mezzo Usato (full width) -->
                  <div class="stat-card stat-card-full">
                    <div class="stat-icon">
                      <i class="fas fa-bicycle"></i>
                    </div>
                    <div class="stat-content">
                      <div class="stat-label">Ultimo Mezzo Utilizzato</div>
                      <div class="stat-value" id="userLastVehicle">N/A</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===== CARD: CRONOLOGIA CORSE ===== -->
            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-history"></i>
                  Cronologia Corse
                </h2>
              </div>
              <div class="card-body">
                <!-- Messaggio quando nessuna corsa disponibile -->
                <div id="noRidesMessage" class="no-rides-message">
                  <i class="fas fa-inbox"></i>
                  <p>Nessuna corsa ancora. Inizia la tua prima avventura!</p>
                </div>

                <!-- Tabella corse con scroll orizzontale -->
                <div
                  id="ridesHistoryContainer"
                  class="rides-history-container hidden"
                >
                  <div class="rides-table-wrapper">
                    <table class="rides-table">
                      <thead>
                        <tr>
                          <th>Data</th>
                          <th>Mezzo</th>
                          <th>Durata</th>
                          <th>Distanza</th>
                          <th>Costo</th>
                          <th>Sconto</th>
                        </tr>
                      </thead>
                      <tbody id="ridesHistoryBody">
                        <!-- Righe popolate dinamicamente con JS -->
                      </tbody>
                    </table>
                  </div>

                  <!-- Controlli Paginazione -->
                  <div id="ridesPagination" class="pagination"></div>
                </div>
              </div>
            </div>

            <!-- ===== CARD: SALDO CREDITO ===== -->
            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-wallet"></i>
                  Saldo Credito
                </h2>
              </div>
              <div class="card-body">
                <div class="balance-container">
                  <div class="balance-amount" id="userBalance">€ 0,00</div>
                  <p class="balance-description">
                    Credito disponibile per le prenotazioni
                  </p>
                </div>
              </div>
            </div>

            <!-- ===== CARD: PUNTI FEDELTÀ ===== -->
            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-star"></i>
                  Punti Fedeltà
                </h2>
              </div>
              <div class="card-body">
                <div class="loyalty-container">
                  <!-- Numero punti grande con etichetta -->
                  <div class="loyalty-score">
                    <span class="loyalty-number" id="userLoyaltyPoints">0</span>
                    <span class="loyalty-label">punti</span>
                  </div>

                  <!-- Informazioni sconto calcolato -->
                  <div class="loyalty-info">
                    <p class="loyalty-description">
                      Guadagna punti con le corse in bicicletta muscolare
                    </p>
                    <div class="loyalty-discount">
                      <span class="discount-label">Valore sconto:</span>
                      <span class="discount-value" id="userLoyaltyValue"
                        >€ 0,00</span
                      >
                    </div>
                  </div>

                  <!-- Progress bar verso il prossimo traguardo (100 punti = €5) -->
                  <div class="loyalty-progress">
                    <div class="progress-bar-container">
                      <div
                        class="progress-bar-fill"
                        id="loyaltyProgressBar"
                      ></div>
                    </div>
                    <p class="progress-text" id="loyaltyProgressText">
                      0 / 100 punti verso € 5,00 di sconto
                    </p>
                  </div>

                  <!-- Footer con informazioni utili -->
                  <div class="loyalty-footer">
                    <i class="fas fa-info-circle"></i>
                    <span
                      >Usa i tuoi punti al termine di una corsa per avere uno
                      sconto</span
                    >
                  </div>
                </div>
              </div>
            </div>
            <% } %>
          </section>
        </div>
      </main>
    </div>

    <!-- ===== SNACKBAR NOTIFICHE ===== -->
    <div id="snackbar" class="snackbar"></div>

    <!-- ===== MODAL: ELIMINA PROFILO ===== -->
    <div id="deleteProfileModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Elimina Profilo</h2>
          <button class="modal-close" id="modalClose">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p>Sei sicuro di voler eliminare il tuo profilo?</p>
          <p class="modal-warning">
            <strong>Questa azione non può essere annullata.</strong>
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-danger" id="modalConfirmDelete">
            Elimina Profilo
          </button>
          <button class="btn btn-secondary" id="modalCancel">Annulla</button>
        </div>
      </div>
    </div>

    <!-- ===== MODAL: MODIFICA DATI PERSONALI -->
    <% if (user.role !== 'admin') { %>
    <div id="modifyProfileModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Modifica dati personali</h2>
          <button class="modal-close" id="modalProfileClose">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p class="modal-description">
            Aggiorna i tuoi dati personali.<br />
            Le modifiche avranno effetto sul tuo account.
          </p>
          <form id="modifyProfileForm">
            <div class="form-row">
              <!-- Campo Nome -->
              <div class="form-group">
                <label for="inputNome" class="form-label">Nome</label>
                <input
                  type="text"
                  id="inputNome"
                  class="form-control"
                  placeholder="Nome"
                  required
                />
              </div>
              <!-- Campo Cognome -->
              <div class="form-group">
                <label for="inputCognome" class="form-label">Cognome</label>
                <input
                  type="text"
                  id="inputCognome"
                  class="form-control"
                  placeholder="Cognome"
                  required
                />
              </div>
            </div>
          </form>
        </div>

        <!-- Contenitore messaggi di errore -->
        <div id="profileErrorContainer" class="error-messages"></div>

        <div class="modal-footer">
          <button class="btn btn-primary" id="modalProfileSave">
            Salva modifiche
          </button>
          <button class="btn btn-secondary" id="modalProfileCancel">
            Annulla
          </button>
        </div>
      </div>
    </div>
    <% } %>

    <!-- ===== MODAL: MODIFICA PASSWORD ===== -->
    <div id="modifyPasswordModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Modifica password</h2>
          <button class="modal-close" id="modalPasswordClose">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p class="modal-description">
            Inserisci la tua password attuale e la nuova<br />
            password che desideri impostare.
          </p>
          <form id="modifyPasswordForm">
            <!-- Campo Password Attuale -->
            <div class="form-group">
              <label for="currentPassword" class="form-label">
                Password attuale
              </label>
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="currentPassword"
                  class="form-control"
                  placeholder="Password Attuale"
                  required
                />
                <i class="fas fa-lock password-icon"></i>
              </div>
            </div>

            <!-- Campo Nuova Password -->
            <div class="form-group">
              <label for="newPassword" class="form-label">Nuova password</label>
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="newPassword"
                  class="form-control"
                  placeholder="Nuova Password"
                  required
                />
                <i class="fas fa-lock password-icon"></i>
              </div>
            </div>

            <!-- Campo Conferma Password -->
            <div class="form-group">
              <label for="confirmPassword" class="form-label">
                Conferma nuova password
              </label>
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="confirmPassword"
                  class="form-control"
                  placeholder="Conferma Nuova Password"
                  required
                />
                <i class="fas fa-lock password-icon"></i>
              </div>
            </div>
          </form>
        </div>

        <!-- Contenitore messaggi di errore -->
        <div id="passwordErrorContainer" class="error-messages"></div>

        <div class="modal-footer">
          <button class="btn btn-primary" id="modalPasswordSave">
            Salva nuova password
          </button>
          <button class="btn btn-secondary" id="modalPasswordCancel">
            Annulla
          </button>
        </div>
      </div>
    </div>

    <!-- ===== SCRIPTS ===== -->
    <script src="/js/profile-utente.js"></script>
  </body>
</html>
