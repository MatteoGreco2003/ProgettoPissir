<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Utente</title>
    <link rel="stylesheet" href="/css/navbar-sidebar.css" />
    <link rel="stylesheet" href="/css/home-utente.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
    />
    <!-- Leaflet JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

    <!-- Libreria MQTT per browser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>

    <!-- MQTT Manager -->
    <script src="/js/mqtt-manager.js"></script>
  </head>

  <body>
    <div id="app">
      <%- include('./components/navbar') %>
      <%- include('./components/sidebar') %>

      <main class="main-content">
        <div class="container">
          <section id="homepage" class="page-section active">
            <div id="topBannerContainer"></div>

            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-map"></i>
                  Mappa Parcheggi
                </h2>
              </div>
              <div class="card-body" style="padding: 0">
                <div id="parkingMap"></div>
              </div>
            </div>

            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-map-marker-alt"></i>
                  Parcheggi
                </h2>
              </div>
              <div class="card-body">
                <div class="parking-grid" id="parkingGrid">
                </div>
              </div>
            </div>

            <div class="card mb-6">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-motorcycle"></i>
                  Veicoli
                </h2>

                <div class="vehicles-filter-container mb-6">
                  <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-th"></i>
                    Tutti
                  </button>
                  <button class="filter-btn" data-filter="bicicletta_muscolare">
                    <i class="fas fa-bicycle"></i>
                    Biciclette Muscolari
                  </button>
                  <button class="filter-btn" data-filter="monopattini">
                    <i class="fas fa-person-skating"></i>
                    Monopattini Elettrici
                  </button>
                  <button class="filter-btn" data-filter="bicicletta_elettrica">
                    <i class="fas fa-bolt"></i>
                    Biciclette Elettriche
                  </button>
                </div>

                <select id="filterSelect" class="filter-select">
                  <option value="all">Tutti</option>
                  <option value="bicicletta_muscolare">
                    Biciclette Muscolari
                  </option>
                  <option value="monopattini">Monopattini Elettrici</option>
                  <option value="bicicletta_elettrica">
                    Biciclette Elettriche
                  </option>
                </select>
              </div>
              <div class="card-body">
                <select id="parkingFilterSelect" class="parking-filter-select">
                  <option value="">Tutti</option>
                </select>
                <div id="loadingSpinner" class="loading-spinner hidden">
                  <div class="spinner"></div>
                  <p>Caricamento mezzi...</p>
                </div>

                <div class="vehicles-grid" id="vehiclesGrid">
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div id="snackbar" class="snackbar"></div>

    <!-- MODAL ELIMINA PROFILO -->
    <div id="deleteProfileModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Elimina Profilo</h2>
          <button class="modal-close" id="sidebarModalClose">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p>Sei sicuro di voler eliminare il tuo profilo?</p>
          <p class="modal-warning">
            <strong>Questa azione non pu√≤ essere annullata.</strong>
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-danger" id="sidebarModalConfirm">
            Elimina Profilo
          </button>
          <button class="btn btn-secondary" id="sidebarModalCancel">
            Annulla
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL PRENOTAZIONE CORSA -->
    <div id="reservationModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Conferma Prenotazione</h2>
          <button class="modal-close" id="modalClose">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="vehicle-summary">
            <div class="summary-item">
              <span class="summary-label">Mezzo:</span>
              <span class="summary-value" id="summaryVehicleId">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Tipologia:</span>
              <span class="summary-value" id="summaryVehicleType">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Batteria:</span>
              <span class="summary-value" id="summaryBattery">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Parcheggio:</span>
              <span class="summary-value" id="summaryParking">-</span>
            </div>
          </div>
          <div
            id="reportWarningBox"
            class="warning-box report-warning hidden"
            style="margin-bottom: 20px"
          >
            <i class="fas fa-exclamation-triangle"></i>
            <div>
              <p>Segnalazione attiva</p>
              <p id="reportDetails"></p>
            </div>
          </div>
          <div class="warning-box">
            <i class="fas fa-info-circle"></i>
            <p>
              Assicurati di avere saldo sufficiente. La tariffa √® di ‚Ç¨1,00 per i
              primi 30 minuti.
            </p>
          </div>

          <div id="reservationError" class="error-box hidden"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="confirmReservation">
            Conferma
          </button>
          <button class="btn btn-secondary" id="cancelReservation">
            Annulla
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL FEEDBACK CORSA -->
    <div id="feedbackModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content feedback-modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Laciaci un feedback!</h2>
          <button class="modal-close" id="feedbackModalClose">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <div class="feedback-ride-info">
            <div class="feedback-ride-item">
              <span class="feedback-ride-label">Mezzo:</span>
              <span class="feedback-ride-value" id="feedbackMezzoType">-</span>
            </div>
          </div>

          <div class="feedback-divider"></div>

          <div class="feedback-rating-container">
            <label class="feedback-label">Valuta la corsa:</label>
            <div class="feedback-stars" id="feedbackStars">
              <button class="feedback-star" data-rating="1" title="Pessima">
                <i class="fas fa-star"></i>
              </button>
              <button class="feedback-star" data-rating="2" title="Cattiva">
                <i class="fas fa-star"></i>
              </button>
              <button class="feedback-star" data-rating="3" title="Normale">
                <i class="fas fa-star"></i>
              </button>
              <button class="feedback-star" data-rating="4" title="Buona">
                <i class="fas fa-star"></i>
              </button>
              <button class="feedback-star" data-rating="5" title="Eccellente">
                <i class="fas fa-star"></i>
              </button>
            </div>
            <div class="feedback-rating-text" id="feedbackRatingText">
              Seleziona una valutazione
            </div>
          </div>

          <div class="feedback-divider"></div>

          <div class="feedback-comment-container">
            <label class="feedback-label">Commento (opzionale):</label>
            <textarea
              id="feedbackComment"
              class="feedback-textarea"
              placeholder="Lascia un commento sulla tua esperienza..."
              maxlength="500"
            ></textarea>
            <div class="feedback-char-count">
              <span id="feedbackCharCount">0</span>/500
            </div>
          </div>

          <div class="feedback-divider"></div>

          <div class="feedback-report-container">
            <label class="feedback-label">
              Segnala un problema (opzionale):
            </label>
            <select id="feedbackReportType" class="feedback-select" size="3">
              <option value="">Nessun problema</option>
              <option value="danno_fisico">üî® Danno fisico</option>
              <option value="batteria_scarica">üîã Batteria scarica</option>
              <option value="pneumatico_bucato">üõû Pneumatico bucato</option>
              <option value="non_funziona">‚öôÔ∏è Non funziona</option>
              <option value="sporco">üßπ Sporco</option>
              <option value="altro">üìù Altro</option>
            </select>
          </div>

          <div
            class="feedback-description-container"
            id="reportDescriptionContainer"
            style="display: none"
          >
            <label class="feedback-label"
              >Descrivi il problema (opzionale):</label
            >
            <textarea
              id="feedbackReportDescription"
              class="feedback-textarea"
              placeholder="Raccontaci i dettagli del problema..."
              maxlength="500"
            ></textarea>
            <div class="feedback-char-count">
              <span id="feedbackReportCharCount">0</span>/500
            </div>
          </div>
        </div>

        <div id="feedbackErrorContainer" class="feedback-error-container"></div>

        <div class="modal-footer">
          <button class="btn btn-primary" id="submitFeedback">
            Invia Feedback
          </button>
          <button class="btn btn-secondary" id="skipFeedback">Salta</button>
        </div>
      </div>
    </div>

    <script src="/js/home-utente.js"></script>
  </body>
</html>
